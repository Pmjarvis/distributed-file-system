[2025-11-19 00:22:33] --- LOGGING STARTED ---
[2025-11-19 00:22:33] MAIN: Starting Storage Server...
[2025-11-19 00:22:33] MAIN: Using local data directory ID: 26
[2025-11-19 00:22:33] MAIN: Initializing metadata hash table...
[2025-11-19 00:22:33] No existing metadata file found at ss_data_26/metadata.db (starting fresh)
[2025-11-19 00:22:33] MAIN: No existing metadata DB found, creating new table
[2025-11-19 00:22:33] Nested metadata hash table initialized: 1024 outer buckets Ã— 64 inner buckets (1024 locks)
[2025-11-19 00:22:33] MAIN: Connected to Name Server. Scanning local files...
[2025-11-19 00:22:33] MAIN: Found 0 local files. Registering...
[2025-11-19 00:22:33] MAIN: Registration complete. This SS ID is 1
[2025-11-19 00:22:33] MAIN: Will send replications to: 127.0.0.1:9002
[2025-11-19 00:22:33] MAIN: Listening for Replication on 127.0.0.4:9004
[2025-11-19 00:22:33] MAIN: All threads started. Server is running.
[2025-11-19 00:22:33] MAIN: Press Ctrl+C for graceful shutdown.
[2025-11-19 00:22:33] CHECKPOINT: Thread started (interval: 60 seconds)
[2025-11-19 00:22:33] MAIN: Listening for Clients and NS on 127.0.0.4:9003
[2025-11-19 00:23:33] CHECKPOINT: Saving metadata to disk...
[2025-11-19 00:23:33] Saving metadata to ss_data_26/metadata.db (atomic snapshot)...
[2025-11-19 00:23:33] Successfully saved 0 metadata entries (atomic snapshot)
[2025-11-19 00:23:33] CHECKPOINT: Metadata saved successfully (0 entries)
[2025-11-19 00:23:40] HANDLER: New NAME SERVER connection from 127.0.0.1 (Req: 32)
[2025-11-19 00:23:40] DEBUG: Lazily created inner table for outer bucket 70
[2025-11-19 00:23:40] Inserted metadata for: kkk (owner: kai, size: 0, is_backup: 0)
[2025-11-19 00:23:40] CREATE: File kkk created by kai
[2025-11-19 00:23:40] REPL: Scheduling update for kkk
[2025-11-19 00:23:40] HANDLER: Closing connection from 127.0.0.1
[2025-11-19 00:23:40] REPL: Connected to backup. Replicating update for kkk...
[2025-11-19 00:23:40] REPL: Replicating kkk (owner: kai, size: 0)
[2025-11-19 00:23:40] REPL: Successfully replicated kkk (0 bytes)
[2025-11-19 00:23:40] REPL: ACK received for file kkk
[2025-11-19 00:23:42] HANDLER: New NAME SERVER connection from 127.0.0.1 (Req: 34)
[2025-11-19 00:23:42] INFO: NS requesting metadata for kkk (for VIEW -l)
[2025-11-19 00:23:42] INFO: Returning cached metadata for kkk (size: 0, words: 0, chars: 0)
[2025-11-19 00:23:42] HANDLER: Closing connection from 127.0.0.1
[2025-11-19 00:23:47] HANDLER: New CLIENT connection from 127.0.0.1 (Req: 40)
[2025-11-19 00:23:47] HANDLER: Routing to ss_handle_read() for message type 40
[2025-11-19 00:23:47] READ: Handler called for file 'kkk'
[2025-11-19 00:23:47] READ: Starting read for file kkk
[2025-11-19 00:23:47] READ: Full path is ss_data_26/files/kkk
[2025-11-19 00:23:47] READ: File opened successfully, starting to read chunks
[2025-11-19 00:23:47] READ: File is empty, sending empty final chunk
[2025-11-19 00:23:47] READ: Read complete for kkk, sent 0 chunks
[2025-11-19 00:23:47] HANDLER: Closing connection from 127.0.0.1
[2025-11-19 00:23:49] HANDLER: New CLIENT connection from 127.0.0.1 (Req: 42)
[2025-11-19 00:23:49] WRITE: Locked file kkk (sentence 0)
[2025-11-19 00:23:57] Updated size for kkk: 28 bytes
[2025-11-19 00:23:57] Updated counts for kkk: 2 words, 28 chars
[2025-11-19 00:23:57] WRITE: Updated metadata for kkk (size: 28, words: 2, chars: 28)
[2025-11-19 00:23:57] WRITE: Completed for kkk (sentence 0)
[2025-11-19 00:23:57] REPL: Scheduling update for kkk
[2025-11-19 00:23:57] REPL: Connected to backup. Replicating update for kkk...
[2025-11-19 00:23:57] REPL: Replicating kkk (owner: kai, size: 28)
[2025-11-19 00:23:57] REPL: Successfully replicated kkk (28 bytes)
[2025-11-19 00:23:57] REPL: ACK received for file kkk
[2025-11-19 00:23:58] HANDLER: New CLIENT connection from 127.0.0.1 (Req: 40)
[2025-11-19 00:23:58] HANDLER: Routing to ss_handle_read() for message type 40
[2025-11-19 00:23:58] READ: Handler called for file 'kkk'
[2025-11-19 00:23:58] READ: Starting read for file kkk
[2025-11-19 00:23:58] READ: Full path is ss_data_26/files/kkk
[2025-11-19 00:23:58] READ: File opened successfully, starting to read chunks
[2025-11-19 00:23:58] READ: Chunk 1 - read 28 bytes, is_final=1
[2025-11-19 00:23:58] READ: Chunk 1 sent
[2025-11-19 00:23:58] READ: Read complete for kkk, sent 1 chunks
[2025-11-19 00:23:58] HANDLER: Closing connection from 127.0.0.1
[2025-11-19 00:24:02] CLIENT_LISTENER: Thread exiting
[2025-11-19 00:24:02] CHECKPOINT: Thread exiting
[2025-11-19 00:24:02] REPL_LISTENER: Thread exiting
[2025-11-19 00:24:03] HEARTBEAT: Thread exiting
[2025-11-19 00:24:03] MAIN: All threads stopped. Performing final cleanup...
[2025-11-19 00:24:03] MAIN: Performing final metadata save (1 entries)...
[2025-11-19 00:24:03] Saving metadata to ss_data_26/metadata.db (atomic snapshot)...
[2025-11-19 00:24:03] Successfully saved 1 metadata entries (atomic snapshot)
[2025-11-19 00:24:03] MAIN: Final metadata save successful
[2025-11-19 00:24:03] Nested metadata hash table freed (1024 locks destroyed)
[2025-11-19 00:24:03] REPL: Worker thread shutting down.
[2025-11-19 00:24:03] --- LOGGING STOPPED ---
