[2025-11-20 02:32:38] --- LOGGING STARTED ---
[2025-11-20 02:32:38] MAIN: Persistent log file initialized for SS ID 1
[2025-11-20 02:32:38] MAIN: Using persistent data directory: ss_data_1
[2025-11-20 02:32:38] MAIN: Loading metadata hash table (post-registration)...
[2025-11-20 02:32:38] Loading 2 metadata entries from ss_data_1/metadata.db...
[2025-11-20 02:32:38] Nested metadata hash table initialized: 1024 outer buckets Ã— 64 inner buckets (1024 locks)
[2025-11-20 02:32:38] DEBUG: Lazily created inner table for outer bucket 523
[2025-11-20 02:32:38] Inserted metadata for: f (owner: pat, size: 26, is_backup: 0)
[2025-11-20 02:32:38] DEBUG: Lazily created inner table for outer bucket 540
[2025-11-20 02:32:38] Inserted metadata for: w (owner: pat, size: 0, is_backup: 1)
[2025-11-20 02:32:38] Loaded 2/2 metadata entries from ss_data_1/metadata.db
[2025-11-20 02:32:38] MAIN: Loaded metadata for 2 files from disk
[2025-11-20 02:32:38] MAIN: Listening for Clients and NS on 127.0.0.3:9003
[2025-11-20 02:32:38] MAIN: Listening for Replication on 127.0.0.3:9004
[2025-11-20 02:32:38] MAIN: Core listener & worker threads started (pre-file-scan). Ready for NS control messages.
[2025-11-20 02:32:38] NS_CONTROL: Listener thread started for NS control messages
[2025-11-20 02:32:38] CHECKPOINT: Thread started (interval: 60 seconds)
[2025-11-20 02:32:38] REPL_IN: New incoming replication connection
[2025-11-20 02:32:38] NS_CONTROL: Received message type 60 from NS
[2025-11-20 02:32:38] RECOVERY: NS requests re-replication of all files to backup SS 0 (127.0.0.2:9002)
[2025-11-20 02:32:38] RECOVERY: Initiating immediate re-replication for existing primary files
[2025-11-20 02:32:38] REPL_IN: Receiving replica for w (0 bytes)
[2025-11-20 02:32:38] REPL: Scheduling update for f
[2025-11-20 02:32:38] REPL: Scheduling update for f
[2025-11-20 02:32:38] RECOVERY: Re-replication scheduling complete (1 primary files queued)
[2025-11-20 02:32:38] MAIN: File scan complete (0 existing files added post-startup)
[2025-11-20 02:32:38] MAIN: Will send replications to: 127.0.0.2:9002
[2025-11-20 02:32:38] MAIN: Server initialization complete (threads already running). Press Ctrl+C for graceful shutdown.
[2025-11-20 02:32:38] REPL_IN: Finished receiving w
[2025-11-20 02:32:38] Updated metadata for: w
[2025-11-20 02:32:38] REPL_IN: Updated metadata for w (owner: pat, size: 0, is_backup=true)
[2025-11-20 02:32:38] REPL: Connected to backup. Replicating update for f...
[2025-11-20 02:32:38] REPL: Replicating f (owner: pat, size: 26)
[2025-11-20 02:32:38] REPL_IN: New incoming replication connection
[2025-11-20 02:32:38] REPL: Successfully replicated f (26 bytes)
[2025-11-20 02:32:38] REPL_IN: Receiving replica for w (0 bytes)
[2025-11-20 02:32:38] REPL_IN: Finished receiving w
[2025-11-20 02:32:38] Updated metadata for: w
[2025-11-20 02:32:38] REPL_IN: Updated metadata for w (owner: pat, size: 0, is_backup=true)
[2025-11-20 02:32:38] REPL: ACK received for file f
[2025-11-20 02:33:12] HANDLER: New NAME SERVER connection from 127.0.0.1 (Req: 32)
[2025-11-20 02:33:12] Updated metadata for: f
[2025-11-20 02:33:12] CREATE: File f created by bob
[2025-11-20 02:33:12] REPL: Scheduling update for f
[2025-11-20 02:33:12] HANDLER: Closing connection from 127.0.0.1
[2025-11-20 02:33:12] REPL: Connected to backup. Replicating update for f...
[2025-11-20 02:33:12] REPL: Replicating f (owner: bob, size: 0)
[2025-11-20 02:33:12] REPL: Successfully replicated f (0 bytes)
[2025-11-20 02:33:12] REPL: ACK received for file f
[2025-11-20 02:33:16] REPL_IN: New incoming replication connection
[2025-11-20 02:33:16] REPL_IN: Receiving replica for ff (0 bytes)
[2025-11-20 02:33:16] REPL_IN: Finished receiving ff
[2025-11-20 02:33:16] DEBUG: Lazily created inner table for outer bucket 977
[2025-11-20 02:33:16] Inserted metadata for: ff (owner: bob, size: 0, is_backup: 1)
[2025-11-20 02:33:16] REPL_IN: Created metadata for ff (owner: bob, is_backup=true)
[2025-11-20 02:33:38] REPL_IN: New incoming replication connection
[2025-11-20 02:33:38] REPL_IN: Receiving replica for ff (9 bytes)
[2025-11-20 02:33:38] REPL_IN: Finished receiving ff
[2025-11-20 02:33:38] Updated metadata for: ff
[2025-11-20 02:33:38] REPL_IN: Updated metadata for ff (owner: bob, size: 9, is_backup=true)
[2025-11-20 02:33:38] CHECKPOINT: Saving metadata to disk...
[2025-11-20 02:33:38] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 02:33:38] Successfully saved 3 metadata entries (atomic snapshot)
[2025-11-20 02:33:38] CHECKPOINT: Metadata saved successfully (3 entries)
[2025-11-20 02:34:38] CHECKPOINT: Saving metadata to disk...
[2025-11-20 02:34:38] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 02:34:38] Successfully saved 3 metadata entries (atomic snapshot)
[2025-11-20 02:34:38] CHECKPOINT: Metadata saved successfully (3 entries)
[2025-11-20 02:35:23] HANDLER: New CLIENT connection from 127.0.0.1 (Req: 42)
[2025-11-20 02:35:23] WRITE: Locked file ff (sentence 0)
[2025-11-20 02:35:27] HANDLER: New CLIENT connection from 127.0.0.1 (Req: 40)
[2025-11-20 02:35:27] HANDLER: Routing to ss_handle_read() for message type 40
[2025-11-20 02:35:27] READ: Handler called for file 'ff'
[2025-11-20 02:35:27] READ: Starting read for file ff
[2025-11-20 02:35:38] CHECKPOINT: Saving metadata to disk...
[2025-11-20 02:35:38] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 02:35:38] Successfully saved 3 metadata entries (atomic snapshot)
[2025-11-20 02:35:38] CHECKPOINT: Metadata saved successfully (3 entries)
[2025-11-20 02:36:38] CHECKPOINT: Saving metadata to disk...
[2025-11-20 02:36:38] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 02:36:38] Successfully saved 3 metadata entries (atomic snapshot)
[2025-11-20 02:36:38] CHECKPOINT: Metadata saved successfully (3 entries)
[2025-11-20 02:37:01] WRITE: Invalid word index 5 (max: 3) - IGNORING subquery
[2025-11-20 02:37:05] WRITE: Invalid word index 4 (max: 3) - IGNORING subquery
[2025-11-20 02:37:18] Updated size for ff: 18 bytes
[2025-11-20 02:37:18] Updated counts for ff: 7 words, 18 chars
[2025-11-20 02:37:18] WRITE: Updated metadata for ff (size: 18, words: 7, chars: 18)
[2025-11-20 02:37:18] WRITE: Completed for ff (sentence 0)
[2025-11-20 02:37:18] REPL: Scheduling update for ff
[2025-11-20 02:37:18] READ: Full path is ss_data_1/files/ff
[2025-11-20 02:37:18] READ: File opened successfully, starting to read chunks
[2025-11-20 02:37:18] READ: Chunk 1 - read 18 bytes, is_final=1
[2025-11-20 02:37:18] REPL: Skipping backup file ff (not replicating backups to prevent cascading)
[2025-11-20 02:37:18] READ: Chunk 1 sent
[2025-11-20 02:37:18] READ: Read complete for ff, sent 1 chunks
[2025-11-20 02:37:18] HANDLER: Closing connection from 127.0.0.1
[2025-11-20 02:37:38] CHECKPOINT: Saving metadata to disk...
[2025-11-20 02:37:38] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 02:37:38] Successfully saved 3 metadata entries (atomic snapshot)
[2025-11-20 02:37:38] CHECKPOINT: Metadata saved successfully (3 entries)
[2025-11-20 02:38:38] CHECKPOINT: Saving metadata to disk...
[2025-11-20 02:38:38] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 02:38:38] Successfully saved 3 metadata entries (atomic snapshot)
[2025-11-20 02:38:38] CHECKPOINT: Metadata saved successfully (3 entries)
[2025-11-20 02:39:38] CHECKPOINT: Saving metadata to disk...
[2025-11-20 02:39:38] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 02:39:38] Successfully saved 3 metadata entries (atomic snapshot)
[2025-11-20 02:39:38] CHECKPOINT: Metadata saved successfully (3 entries)
[2025-11-20 02:40:38] CHECKPOINT: Saving metadata to disk...
[2025-11-20 02:40:38] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 02:40:38] Successfully saved 3 metadata entries (atomic snapshot)
[2025-11-20 02:40:38] CHECKPOINT: Metadata saved successfully (3 entries)
[2025-11-20 02:41:38] CHECKPOINT: Saving metadata to disk...
[2025-11-20 02:41:38] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 02:41:38] Successfully saved 3 metadata entries (atomic snapshot)
[2025-11-20 02:41:38] CHECKPOINT: Metadata saved successfully (3 entries)
[2025-11-20 02:42:38] CHECKPOINT: Saving metadata to disk...
[2025-11-20 02:42:38] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 02:42:38] Successfully saved 3 metadata entries (atomic snapshot)
[2025-11-20 02:42:38] CHECKPOINT: Metadata saved successfully (3 entries)
