[2025-11-20 22:25:22] --- LOGGING STARTED ---
[2025-11-20 22:25:22] MAIN: Persistent log file initialized for SS ID 1
[2025-11-20 22:25:22] MAIN: Using persistent data directory: ss_data_1
[2025-11-20 22:25:22] MAIN: Loading metadata hash table (post-registration)...
[2025-11-20 22:25:22] No existing metadata file found at ss_data_1/metadata.db (starting fresh)
[2025-11-20 22:25:22] MAIN: No existing metadata DB found for SS ID 1, creating new table
[2025-11-20 22:25:22] Nested metadata hash table initialized: 1024 outer buckets × 64 inner buckets (1024 locks)
[2025-11-20 22:25:22] MAIN: Listening for Clients and NS on 10.34.17.143:9002
[2025-11-20 22:25:22] MAIN: Listening for Replication on 10.34.17.143:9003
[2025-11-20 22:25:22] MAIN: Core listener & worker threads started (pre-file-scan). Ready for NS control messages.
[2025-11-20 22:25:22] NS_CONTROL: Listener thread started for NS control messages
[2025-11-20 22:25:22] CHECKPOINT: Thread started (interval: 60 seconds)
[2025-11-20 22:25:22] MAIN: File scan complete (no existing files found)
[2025-11-20 22:25:22] MAIN: Will send replications to: 10.34.17.66:9002
[2025-11-20 22:25:22] MAIN: Server initialization complete (threads already running). Press Ctrl+C for graceful shutdown.
[2025-11-20 22:25:22] NS_CONTROL: Received message type 60 from NS
[2025-11-20 22:25:22] RECOVERY: NS requests re-replication of all files to backup SS 0 (10.34.17.66:9002)
[2025-11-20 22:25:22] RECOVERY: Initiating immediate re-replication for existing primary files
[2025-11-20 22:25:22] RECOVERY: Re-replication scheduling complete (0 primary files queued)
[2025-11-20 22:25:28] NS_CONTROL: Received message type 61 from NS
[2025-11-20 22:25:28] HANDLER: Received backup assignment update from NS
[2025-11-20 22:25:28] HANDLER: Backup assignment updated - will replicate to 10.34.17.66:9005 (SS ID 2)
[2025-11-20 22:25:28] HANDLER: Initiating immediate catch-up replication for existing primary files
[2025-11-20 22:25:28] HANDLER: Catch-up replication scheduling complete (0 primary files queued)
[2025-11-20 22:25:28] NS_CONTROL: Received message type 60 from NS
[2025-11-20 22:25:28] RECOVERY: NS requests re-replication of all files to backup SS 2 (10.34.17.66:9005)
[2025-11-20 22:25:28] RECOVERY: Initiating immediate re-replication for existing primary files
[2025-11-20 22:25:28] RECOVERY: Re-replication scheduling complete (0 primary files queued)
[2025-11-20 22:25:47] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 32)
[2025-11-20 22:25:47] DEBUG: Lazily created inner table for outer bucket 924
[2025-11-20 22:25:47] Inserted metadata for: f1 (owner: pop1, size: 0, is_backup: 0)
[2025-11-20 22:25:47] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:25:47] Successfully saved 1 metadata entries (atomic snapshot)
[2025-11-20 22:25:47] CREATE: File f1 created by pop1
[2025-11-20 22:25:47] REPL: Scheduling update for f1
[2025-11-20 22:25:47] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 22:25:47] REPL: Connected to backup. Replicating update for f1...
[2025-11-20 22:25:47] REPL: Replicating f1 (owner: pop1, size: 0)
[2025-11-20 22:25:47] REPL: Successfully replicated f1 (0 bytes)
[2025-11-20 22:25:47] REPL: ACK received for file f1
[2025-11-20 22:25:49] REPL_IN: New incoming replication connection
[2025-11-20 22:25:50] REPL_IN: Receiving replica for f2 (0 bytes)
[2025-11-20 22:25:50] REPL_IN: Acquired write lock for f2
[2025-11-20 22:25:50] REPL_IN: Finished receiving f2
[2025-11-20 22:25:50] DEBUG: Lazily created inner table for outer bucket 925
[2025-11-20 22:25:50] Inserted metadata for: f2 (owner: pop1, size: 0, is_backup: 1)
[2025-11-20 22:25:50] REPL_IN: Created metadata for f2 (owner: pop1, is_backup=true)
[2025-11-20 22:25:50] REPL_IN: Released write lock for f2
[2025-11-20 22:25:52] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 22:25:52] INFO: NS requesting metadata for f1 (for VIEW -l)
[2025-11-20 22:25:52] INFO: Returning cached metadata for f1 (size: 0, words: 0, chars: 0)
[2025-11-20 22:25:52] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 22:26:22] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:26:22] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:26:22] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:26:22] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:26:50] NS_CONTROL: Received message type 61 from NS
[2025-11-20 22:26:50] HANDLER: Received backup assignment update from NS
[2025-11-20 22:26:50] HANDLER: Backup assignment updated - will replicate to 10.34.17.66:9005 (SS ID 2)
[2025-11-20 22:26:50] HANDLER: Initiating immediate catch-up replication for existing primary files
[2025-11-20 22:26:50] REPL: Scheduling update for f1
[2025-11-20 22:26:50] HANDLER: Catch-up replication scheduling complete (1 primary files queued)
[2025-11-20 22:26:50] NS_CONTROL: Received message type 58 from NS
[2025-11-20 22:26:50] RECOVERY: NS requests sync FROM backup TO primary SS 2 (10.34.17.66:9005)
[2025-11-20 22:26:50] RECOVERY: Failed to connect to primary SS 2 at 10.34.17.66:9005
[2025-11-20 22:26:50] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 22:26:50] REPL: Re-queueing f1 for retry attempt 1
[2025-11-20 22:26:50] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 22:26:50] REPL: Re-queueing f1 for retry attempt 2
[2025-11-20 22:26:50] REPL: Connected to backup. Replicating update for f1...
[2025-11-20 22:26:50] REPL_IN: New incoming replication connection
[2025-11-20 22:26:50] REPL: Replicating f1 (owner: pop1, size: 0)
[2025-11-20 22:26:50] REPL: Successfully replicated f1 (0 bytes)
[2025-11-20 22:26:50] REPL_IN: Receiving replica for f2 (0 bytes)
[2025-11-20 22:26:50] REPL_IN: Acquired write lock for f2
[2025-11-20 22:26:50] REPL_IN: Finished receiving f2
[2025-11-20 22:26:50] Updated metadata for: f2
[2025-11-20 22:26:50] REPL_IN: Updated metadata for f2 (owner: pop1, size: 0, is_backup=true)
[2025-11-20 22:26:50] REPL_IN: Released write lock for f2
[2025-11-20 22:26:50] REPL: ACK received for file f1
[2025-11-20 22:27:22] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:27:22] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:27:22] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:27:22] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:28:22] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:28:22] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:28:22] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:28:22] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:29:17] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 22:29:17] INFO: NS requesting metadata for f1 (for VIEW -l)
[2025-11-20 22:29:17] INFO: Returning cached metadata for f1 (size: 0, words: 0, chars: 0)
[2025-11-20 22:29:17] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 22:29:22] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:29:22] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:29:22] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:29:22] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:29:32] REPL_IN: New incoming replication connection
[2025-11-20 22:29:32] REPL_IN: Receiving replica for f2 (12 bytes)
[2025-11-20 22:29:32] REPL_IN: Acquired write lock for f2
[2025-11-20 22:29:32] REPL_IN: Finished receiving f2
[2025-11-20 22:29:32] Updated metadata for: f2
[2025-11-20 22:29:32] REPL_IN: Updated metadata for f2 (owner: pop1, size: 12, is_backup=true)
[2025-11-20 22:29:32] REPL_IN: Released write lock for f2
[2025-11-20 22:29:40] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 22:29:40] INFO: NS requesting metadata for f1 (for VIEW -l)
[2025-11-20 22:29:40] INFO: Returning cached metadata for f1 (size: 0, words: 0, chars: 0)
[2025-11-20 22:29:40] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 22:29:40] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 22:29:40] INFO: NS requesting metadata for f2 (for VIEW -l)
[2025-11-20 22:29:40] INFO: Returning cached metadata for f2 (size: 12, words: 0, chars: 0)
[2025-11-20 22:29:40] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 22:29:45] HANDLER: New CLIENT connection from 10.34.17.143 (Req: 40)
[2025-11-20 22:29:45] HANDLER: Routing to ss_handle_read() for message type 40
[2025-11-20 22:29:45] READ: Handler called for file 'f2'
[2025-11-20 22:29:45] READ: Starting read for file f2
[2025-11-20 22:29:45] READ: Full path is ss_data_1/files/f2
[2025-11-20 22:29:45] READ: File opened successfully, starting to read chunks
[2025-11-20 22:29:45] READ: Chunk 1 - read 12 bytes, is_final=1
[2025-11-20 22:29:45] READ: Chunk 1 sent
[2025-11-20 22:29:45] READ: Read complete for f2, sent 1 chunks
[2025-11-20 22:29:45] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 22:29:48] HANDLER: New CLIENT connection from 10.34.17.143 (Req: 41)
[2025-11-20 22:29:48] HANDLER: Routing to ss_handle_stream() for message type 41
[2025-11-20 22:29:48] STREAM: Handler called for file 'f2'
[2025-11-20 22:29:48] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 22:29:52] HANDLER: New CLIENT connection from 10.34.17.143 (Req: 42)
[2025-11-20 22:29:52] WRITE: Created swapfile f2 (sentence 0)
[2025-11-20 22:29:57] WRITE: Acquired global file lock for commit (file f2, sentence 0)
[2025-11-20 22:29:57] WRITE: Committed and deleted swapfile for f2 (sentence 0)
[2025-11-20 22:29:57] Updated size for f2: 26 bytes
[2025-11-20 22:29:57] Updated counts for f2: 4 words, 26 chars
[2025-11-20 22:29:57] WRITE: Updated metadata for f2 (size: 26, words: 4, chars: 26)
[2025-11-20 22:29:57] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:29:57] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:29:57] WRITE: Completed for f2 (sentence 0)
[2025-11-20 22:29:57] REPL: Scheduling update for f2
[2025-11-20 22:29:57] REPL: Skipping backup file f2 (not replicating backups to prevent cascading)
[2025-11-20 22:30:01] HANDLER: New CLIENT connection from 10.34.17.143 (Req: 41)
[2025-11-20 22:30:01] HANDLER: Routing to ss_handle_stream() for message type 41
[2025-11-20 22:30:01] STREAM: Handler called for file 'f2'
[2025-11-20 22:30:02] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 22:30:07] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 22:30:07] INFO: NS requesting metadata for f1 (for VIEW -l)
[2025-11-20 22:30:07] INFO: Returning cached metadata for f1 (size: 0, words: 0, chars: 0)
[2025-11-20 22:30:07] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 22:30:07] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 22:30:07] INFO: NS requesting metadata for f2 (for VIEW -l)
[2025-11-20 22:30:07] INFO: Returning cached metadata for f2 (size: 26, words: 4, chars: 26)
[2025-11-20 22:30:07] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 22:30:11] NS_CONTROL: Received message type 61 from NS
[2025-11-20 22:30:11] HANDLER: Received backup assignment update from NS
[2025-11-20 22:30:11] HANDLER: Backup assignment updated - will replicate to 10.34.17.66:9005 (SS ID 2)
[2025-11-20 22:30:11] HANDLER: Initiating immediate catch-up replication for existing primary files
[2025-11-20 22:30:11] REPL: Scheduling update for f1
[2025-11-20 22:30:11] HANDLER: Catch-up replication scheduling complete (1 primary files queued)
[2025-11-20 22:30:11] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 22:30:11] REPL: Re-queueing f1 for retry attempt 3
[2025-11-20 22:30:11] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 22:30:11] REPL: Re-queueing f1 for retry attempt 4
[2025-11-20 22:30:11] REPL_IN: New incoming replication connection
[2025-11-20 22:30:11] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 22:30:11] REPL: Re-queueing f1 for retry attempt 5
[2025-11-20 22:30:11] REPL_IN: Receiving replica for f2 (12 bytes)
[2025-11-20 22:30:11] REPL_IN: Acquired write lock for f2
[2025-11-20 22:30:11] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 22:30:11] REPL: Giving up on f1 after 5 failed attempts
[2025-11-20 22:30:11] REPL_IN: Finished receiving f2
[2025-11-20 22:30:11] Updated metadata for: f2
[2025-11-20 22:30:11] REPL_IN: Updated metadata for f2 (owner: pop1, size: 12, is_backup=true)
[2025-11-20 22:30:11] REPL_IN: Released write lock for f2
[2025-11-20 22:30:22] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:30:22] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:30:22] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:30:22] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:31:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:31:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:31:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:31:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:32:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:32:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:32:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:32:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:33:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:33:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:33:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:33:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:34:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:34:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:34:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:34:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:35:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:35:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:35:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:35:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:36:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:36:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:36:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:36:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:37:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:37:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:37:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:37:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:38:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:38:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:38:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:38:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:39:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:39:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:39:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:39:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:40:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:40:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:40:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:40:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:41:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:41:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:41:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:41:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:42:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:42:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:42:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:42:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:43:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:43:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:43:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:43:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:44:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:44:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:44:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:44:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:45:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:45:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:45:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:45:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:46:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:46:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:46:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:46:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:47:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:47:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:47:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:47:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:48:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:48:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:48:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:48:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:49:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:49:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:49:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:49:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:50:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:50:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:50:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:50:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:51:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:51:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:51:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:51:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:52:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:52:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:52:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:52:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:53:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:53:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:53:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:53:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:54:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:54:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:54:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:54:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:55:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:55:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:55:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:55:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:56:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:56:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:56:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:56:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:57:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:57:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:57:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:57:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:58:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:58:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:58:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:58:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 22:59:23] CHECKPOINT: Saving metadata to disk...
[2025-11-20 22:59:23] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 22:59:23] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 22:59:23] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:00:03] MAIN: Shutdown detected. Joining threads and performing final cleanup...
[2025-11-20 23:00:04] CLIENT_LISTENER: Thread exiting
[2025-11-20 23:00:04] CHECKPOINT: Thread exiting
[2025-11-20 23:00:04] NS_CONTROL: Listener thread exiting
[2025-11-20 23:00:04] REPL_LISTENER: Thread exiting
[2025-11-20 23:00:08] HEARTBEAT: Thread exiting
[2025-11-20 23:00:08] MAIN: Performing final metadata save (2 entries)...
[2025-11-20 23:00:08] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:00:08] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:00:08] MAIN: Final metadata save successful
[2025-11-20 23:00:08] Nested metadata hash table freed (1024 locks destroyed)
[2025-11-20 23:00:08] REPL: Worker thread shutting down.
[2025-11-20 23:00:08] --- LOGGING STOPPED ---
[2025-11-20 23:00:09] --- LOGGING STARTED ---
[2025-11-20 23:00:09] MAIN: Persistent log file initialized for SS ID 1
[2025-11-20 23:00:09] MAIN: Using persistent data directory: ss_data_1
[2025-11-20 23:00:09] MAIN: Loading metadata hash table (post-registration)...
[2025-11-20 23:00:09] Loading 2 metadata entries from ss_data_1/metadata.db...
[2025-11-20 23:00:09] Nested metadata hash table initialized: 1024 outer buckets × 64 inner buckets (1024 locks)
[2025-11-20 23:00:09] DEBUG: Lazily created inner table for outer bucket 924
[2025-11-20 23:00:09] Inserted metadata for: f1 (owner: pop1, size: 0, is_backup: 0)
[2025-11-20 23:00:09] DEBUG: Lazily created inner table for outer bucket 925
[2025-11-20 23:00:09] Inserted metadata for: f2 (owner: pop1, size: 12, is_backup: 1)
[2025-11-20 23:00:09] Loaded 2/2 metadata entries from ss_data_1/metadata.db
[2025-11-20 23:00:09] MAIN: Loaded metadata for 2 files from disk
[2025-11-20 23:00:09] MAIN: Listening for Clients and NS on 10.34.17.143:9002
[2025-11-20 23:00:09] MAIN: Listening for Replication on 10.34.17.143:9003
[2025-11-20 23:00:09] NS_CONTROL: Listener thread started for NS control messages
[2025-11-20 23:00:09] NS_CONTROL: Received message type 61 from NS
[2025-11-20 23:00:09] HANDLER: Received backup assignment update from NS
[2025-11-20 23:00:09] HANDLER: Backup assignment updated - will replicate to 10.34.17.66:9005 (SS ID 2)
[2025-11-20 23:00:09] HANDLER: Initiating immediate catch-up replication for existing primary files
[2025-11-20 23:00:09] MAIN: Core listener & worker threads started (pre-file-scan). Ready for NS control messages.
[2025-11-20 23:00:09] CHECKPOINT: Thread started (interval: 60 seconds)
[2025-11-20 23:00:09] MAIN: File scan complete (0 existing files added post-startup)
[2025-11-20 23:00:09] MAIN: Will send replications to: 10.34.17.66:9005
[2025-11-20 23:00:09] MAIN: This is a recovery. Waiting for NS to coordinate recovery sync...
[2025-11-20 23:00:09] MAIN: Server initialization complete (threads already running). Press Ctrl+C for graceful shutdown.
[2025-11-20 23:00:09] REPL: Scheduling update for f1
[2025-11-20 23:00:09] HANDLER: Catch-up replication scheduling complete (1 primary files queued)
[2025-11-20 23:00:12] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:00:12] REPL: Re-queueing f1 for retry attempt 1
[2025-11-20 23:00:15] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 23:00:15] INFO: NS requesting metadata for f1 (for VIEW -l)
[2025-11-20 23:00:15] INFO: Returning cached metadata for f1 (size: 0, words: 0, chars: 0)
[2025-11-20 23:00:15] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 23:00:15] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 23:00:15] INFO: NS requesting metadata for f2 (for VIEW -l)
[2025-11-20 23:00:15] INFO: Returning cached metadata for f2 (size: 12, words: 0, chars: 0)
[2025-11-20 23:00:15] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 23:00:15] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:00:15] REPL: Re-queueing f1 for retry attempt 2
[2025-11-20 23:00:17] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 23:00:17] INFO: NS requesting metadata for f1 (for VIEW -l)
[2025-11-20 23:00:17] INFO: Returning cached metadata for f1 (size: 0, words: 0, chars: 0)
[2025-11-20 23:00:17] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 23:00:17] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 23:00:17] INFO: NS requesting metadata for f2 (for VIEW -l)
[2025-11-20 23:00:17] INFO: Returning cached metadata for f2 (size: 12, words: 0, chars: 0)
[2025-11-20 23:00:17] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 23:00:18] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:00:18] REPL: Re-queueing f1 for retry attempt 3
[2025-11-20 23:00:21] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:00:21] REPL: Re-queueing f1 for retry attempt 4
[2025-11-20 23:00:24] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:00:24] REPL: Re-queueing f1 for retry attempt 5
[2025-11-20 23:00:27] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:00:27] REPL: Giving up on f1 after 5 failed attempts
[2025-11-20 23:00:48] MAIN: Shutdown detected. Joining threads and performing final cleanup...
[2025-11-20 23:00:49] REPL_LISTENER: Thread exiting
[2025-11-20 23:00:49] NS_CONTROL: Listener thread exiting
[2025-11-20 23:00:49] HEARTBEAT: Thread exiting
[2025-11-20 23:00:49] CHECKPOINT: Thread exiting
[2025-11-20 23:00:49] CLIENT_LISTENER: Thread exiting
[2025-11-20 23:00:49] MAIN: Performing final metadata save (2 entries)...
[2025-11-20 23:00:49] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:00:49] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:00:49] MAIN: Final metadata save successful
[2025-11-20 23:00:49] Nested metadata hash table freed (1024 locks destroyed)
[2025-11-20 23:00:49] REPL: Worker thread shutting down.
[2025-11-20 23:00:49] --- LOGGING STOPPED ---
[2025-11-20 23:00:50] --- LOGGING STARTED ---
[2025-11-20 23:00:50] MAIN: Persistent log file initialized for SS ID 1
[2025-11-20 23:00:50] MAIN: Using persistent data directory: ss_data_1
[2025-11-20 23:00:50] MAIN: Loading metadata hash table (post-registration)...
[2025-11-20 23:00:50] Loading 2 metadata entries from ss_data_1/metadata.db...
[2025-11-20 23:00:50] Nested metadata hash table initialized: 1024 outer buckets × 64 inner buckets (1024 locks)
[2025-11-20 23:00:50] DEBUG: Lazily created inner table for outer bucket 924
[2025-11-20 23:00:50] Inserted metadata for: f1 (owner: pop1, size: 0, is_backup: 0)
[2025-11-20 23:00:50] DEBUG: Lazily created inner table for outer bucket 925
[2025-11-20 23:00:50] Inserted metadata for: f2 (owner: pop1, size: 12, is_backup: 1)
[2025-11-20 23:00:50] Loaded 2/2 metadata entries from ss_data_1/metadata.db
[2025-11-20 23:00:50] MAIN: Loaded metadata for 2 files from disk
[2025-11-20 23:00:50] MAIN: Listening for Clients and NS on 10.34.17.143:9002
[2025-11-20 23:00:50] MAIN: Listening for Replication on 10.34.17.143:9003
[2025-11-20 23:00:50] CHECKPOINT: Thread started (interval: 60 seconds)
[2025-11-20 23:00:50] MAIN: Core listener & worker threads started (pre-file-scan). Ready for NS control messages.
[2025-11-20 23:00:50] ERROR: File 'lmao.txt' exists but has NO metadata entry! This should never happen for tracked files.
[2025-11-20 23:00:50] ERROR: Possible causes: manual file placement, corrupted metadata.db, or race condition bug
[2025-11-20 23:00:50] ERROR: File 'lmao.txt' exists on disk but missing from metadata table
[2025-11-20 23:00:50] NS_CONTROL: Listener thread started for NS control messages
[2025-11-20 23:00:50] MAIN: File scan complete (0 existing files added post-startup)
[2025-11-20 23:00:50] MAIN: Will send replications to: 10.34.17.66:9005
[2025-11-20 23:00:50] MAIN: This is a recovery. Waiting for NS to coordinate recovery sync...
[2025-11-20 23:00:50] MAIN: Server initialization complete (threads already running). Press Ctrl+C for graceful shutdown.
[2025-11-20 23:00:50] NS_CONTROL: Received message type 61 from NS
[2025-11-20 23:00:50] HANDLER: Received backup assignment update from NS
[2025-11-20 23:00:50] HANDLER: Backup assignment updated - will replicate to 10.34.17.66:9005 (SS ID 2)
[2025-11-20 23:00:50] HANDLER: Initiating immediate catch-up replication for existing primary files
[2025-11-20 23:00:50] REPL: Scheduling update for f1
[2025-11-20 23:00:50] HANDLER: Catch-up replication scheduling complete (1 primary files queued)
[2025-11-20 23:00:53] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:00:53] REPL: Re-queueing f1 for retry attempt 1
[2025-11-20 23:00:56] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:00:56] REPL: Re-queueing f1 for retry attempt 2
[2025-11-20 23:00:59] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:00:59] REPL: Re-queueing f1 for retry attempt 3
[2025-11-20 23:01:00] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 23:01:00] INFO: NS requesting metadata for f1 (for VIEW -l)
[2025-11-20 23:01:00] INFO: Returning cached metadata for f1 (size: 0, words: 0, chars: 0)
[2025-11-20 23:01:00] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 23:01:00] HANDLER: New NAME SERVER connection from 10.34.17.143 (Req: 34)
[2025-11-20 23:01:00] INFO: NS requesting metadata for f2 (for VIEW -l)
[2025-11-20 23:01:00] INFO: Returning cached metadata for f2 (size: 12, words: 0, chars: 0)
[2025-11-20 23:01:00] HANDLER: Closing connection from 10.34.17.143
[2025-11-20 23:01:02] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:01:02] REPL: Re-queueing f1 for retry attempt 4
[2025-11-20 23:01:05] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:01:05] REPL: Re-queueing f1 for retry attempt 5
[2025-11-20 23:01:08] REPL: Could not connect to backup server at 10.34.17.66:9005
[2025-11-20 23:01:08] REPL: Giving up on f1 after 5 failed attempts
[2025-11-20 23:01:50] CHECKPOINT: Saving metadata to disk...
[2025-11-20 23:01:50] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:01:50] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:01:50] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:02:50] CHECKPOINT: Saving metadata to disk...
[2025-11-20 23:02:50] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:02:50] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:02:50] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:03:50] CHECKPOINT: Saving metadata to disk...
[2025-11-20 23:03:50] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:03:50] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:03:50] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:04:50] CHECKPOINT: Saving metadata to disk...
[2025-11-20 23:04:50] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:04:50] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:04:50] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:05:50] CHECKPOINT: Saving metadata to disk...
[2025-11-20 23:05:50] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:05:50] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:05:50] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:06:50] CHECKPOINT: Saving metadata to disk...
[2025-11-20 23:06:50] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:06:50] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:06:50] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:07:50] CHECKPOINT: Saving metadata to disk...
[2025-11-20 23:07:50] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:07:50] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:07:50] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:08:50] CHECKPOINT: Saving metadata to disk...
[2025-11-20 23:08:50] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:08:50] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:08:50] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:09:50] CHECKPOINT: Saving metadata to disk...
[2025-11-20 23:09:50] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:09:50] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:09:50] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:10:50] CHECKPOINT: Saving metadata to disk...
[2025-11-20 23:10:50] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:10:50] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:10:50] CHECKPOINT: Metadata saved successfully (2 entries)
[2025-11-20 23:11:11] MAIN: Shutdown detected. Joining threads and performing final cleanup...
[2025-11-20 23:11:11] NS_CONTROL: Listener thread exiting
[2025-11-20 23:11:11] REPL_LISTENER: Thread exiting
[2025-11-20 23:11:12] CHECKPOINT: Thread exiting
[2025-11-20 23:11:12] CLIENT_LISTENER: Thread exiting
[2025-11-20 23:11:15] HEARTBEAT: Thread exiting
[2025-11-20 23:11:15] MAIN: Performing final metadata save (2 entries)...
[2025-11-20 23:11:15] Saving metadata to ss_data_1/metadata.db (atomic snapshot)...
[2025-11-20 23:11:15] Successfully saved 2 metadata entries (atomic snapshot)
[2025-11-20 23:11:15] MAIN: Final metadata save successful
[2025-11-20 23:11:15] Nested metadata hash table freed (1024 locks destroyed)
[2025-11-20 23:11:15] REPL: Worker thread shutting down.
[2025-11-20 23:11:15] --- LOGGING STOPPED ---
